{% extends 'base.html.twig' %}

{% block title %}Корзина{% endblock %}

{% block body %}
    {{ include('@EasyAdmin/flash_messages.html.twig') }}
    <div id="cart-items">
        {% for cart_item in cart_items %}
            {% include 'pieces/cart_item_card.html.twig' with { 'cart_item': cart_item } %}
        {% endfor %}
    </div>

    {% if cart_items|length > 0 %}
        {% include 'order/create_form.twig' with { 'order_form': order_form } %}
    {% else %}
        <div class="empty-cart-message-wrapper">
            <h5>
                Корзина пуста :(
            </h5>
        </div>
    {% endif %}

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const createOrderForm = document.querySelector('form[name="create_order_form"]')
            createOrderForm.addEventListener('submit', function (e) {
                const cartItemsCheckboxes = document.getElementById('cart-items').querySelectorAll('input[type="checkbox"]')
                let checkedCartItemsIds = ''
                for (let i = 0; i < cartItemsCheckboxes.length; i++) {
                    if(cartItemsCheckboxes[i].checked) {
                        checkedCartItemsIds += ' '+cartItemsCheckboxes[i].getAttribute('value')
                    }
                }
                document.getElementById('cart_items_ids').setAttribute('value', checkedCartItemsIds)
            })
        })
    </script>
{% endblock %}