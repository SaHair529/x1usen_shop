{% set total_price = 0 %}

{# Поиск оповещений текущего заказа среди всех оповещений #}
{% set hasNotifications = false %}
{% for notification in notifications.order_status_changed %}
    {% if notification.updatedOrder is not null and notification.updatedOrder.id == order.id %}
        {% set hasNotifications = true %}
    {% endif %}
{% endfor %}
{# ----------------------------------------------------- #}

<div class="card order-card" style="width: 300px">
    {% if hasNotifications %}
        <span class="notifications-head-indicator"></span>
    {% endif %}
    <div class="card-body">
        <p class="card-title small"><b>Номер телефона: </b>{{ order.phoneNumber }}</p>
        {% if order.city is not null %}
            <p class="card-text small"><b>Город: </b>{{ order.city }}</p>
        {% endif %}
        {% if order.address is not null %}
            <p class="card-text small"><b>Адрес: </b>{{ order.address }}</p>
        {% endif %}
        <p class="card-text small"><b>Способ получения</b>{{ ways_to_get[order.wayToGet] }}</p>
        <p class="card-text small"><b>Статус: </b><span class="order_status_{{ order.status }}">
                {{ statuses[order.status] }}
                {% if hasNotifications %}
                    <span class="notifications-indicator" title="Статус заказа изменился"></span>
                {% endif %}
            </span></p>
        <hr>
        <p><b>Товары:</b></p>
        {% for item in order.items %}
            {% set total_price = total_price + item.quantity * item.product.price %}
            <p class="card-text small">
                <a href="{{ path('detail_info', { 'id': item.product.id }) }}" class="product-link">{{ item.product.name|slice(0, 30) }}...</a>
            </p>
            <p class="card-text small">
                <strong>{{ item.quantity }} шт</strong><strong>{{ item.quantity * item.product.price }}₽</strong>
            </p>
            <hr>
        {% endfor %}
        <p class="card-text"><b style="color: #c92e2e">Итоговая цена: </b><strong>{{ total_price }}₽</strong></p>
    </div>
</div>